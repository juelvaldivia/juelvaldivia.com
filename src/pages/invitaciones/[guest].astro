---
import InvitationsLayout from '@/templates/Invitations.astro';
import {FormConfirm} from '@/components/FormConfirm';
import { AppConfig } from '@/utils/AppConfig';
import { getXataClient } from '@/database/xata';


const { title } = AppConfig;
const { description } = AppConfig;
const guestId = Astro.params.guest;

const xata = getXataClient();
const guest = await xata.db.guests.read(guestId);

export async function getStaticPaths() {
  const xata = getXataClient();
  const guests = await xata.db.guests
  .select(["id", "name", "event_id", "confirmed"])
  .getAll()

  return guests.map(guest => {
    return {
      params: {
        guest: guest.id
      }
    }
  })
}

export const prerender = false;

---

<InvitationsLayout head={{ title, description }}>
  <div class="container mx-auto p-4 pt-6 md:p-6 lg:p-12">
  <div class="text-center mb-8">
    <h1 class="text-4xl font-bold">Hola {guest?.name}</h1>
  </div>
  <div class="flex flex-col items-center justify-center">
    <div class="text-center mb-8">
      <p class="text-lg">
        Estamos emocionados de compartir un momento muy especial en nuestras vidas y queremos que estés presente..
      </p>
      <p class="text-lg">
        Únete a nosotros para descubrir el sexo de nuestro bebé!
      </p>
      <p class="text-lg">Habrá juegos, comida y diversión para todos!</p>
    </div>
    <div class="text-center">
      {guest?.confirmed !== null && (<div>
        Tu ultima confirmación fue: {guest?.confirmed === true ? 'Si podré asistir' : 'No podré asistir'}
        </div>)}
      {<FormConfirm guest={{name: guest?.name, id: guest?.id}}></FormConfirm>}
    </div>
  </div>
  </div>
</InvitationsLayout>
